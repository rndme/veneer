/**  veneer.js custom html tag definition
 {
	tagName: 'veneer-markdown',
	version: '1.0.0', tags: 'optional text',
	purpose: 'Turns markdown text inside the tag into HTML ',
	attribs: {  },
	events:  [ 'update' ]
 }
**/

//////////////////////////////////////////////

(function(){ 
	 	
	  
	  (function(t){function J(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function K(){var u=require("util");return"Markdown.mk_block( "+u.inspect(this.toString())+", "+u.inspect(this.trailing)+", "+u.inspect(this.lineNumber)+" )"}function A(u){for(var b=0,d=-1;-1!==(d=u.indexOf("\n",d+1));)b++;return b}function z(u,b){function d(c){this.len_after=c,this.name="close_"+b}var c=u+"_state",e="strong"==u?"em_state":"strong_state";return function(f,s){if(this[c][0]==b)return this[c].shift(),[f.length,new d(f.length-b.length)];var g=this[e].slice(),h=this[c].slice();this[c].unshift(b);var E=this.processInline(f.substr(b.length)),G=E[E.length-1];return this[c].shift(),G instanceof d?(E.pop(),[f.length-G.len_after,[u].concat(E)]):(this[e]=g,this[c]=h,[b.length,b])}}function q(g){return w(g)&&1<g.length&&"object"==typeof g[1]&&!w(g[1])?g[1]:void 0}function H(g){return g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function I(g){if("string"==typeof g)return H(g);var b=g.shift(),d={},c=[];for(!g.length||"object"!=typeof g[0]||g[0]instanceof Array||(d=g.shift());g.length;)c.push(arguments.callee(g.shift()));var e="",f;for(f in d)e+=" "+f+'="'+H(d[f])+'"';return"img"==b||"br"==b||"hr"==b?"<"+b+e+"/>":"<"+b+e+">"+c.join("")+"</"+b+">"}function L(g,b,d){var c;d=d||{};var e=g.slice(0);"function"==typeof d.preprocessTreeNode&&(e=d.preprocessTreeNode(e,b));var f=q(e);if(f){e[1]={};for(c in f)e[1][c]=f[c];f=e[1]}if("string"==typeof e)return e;switch(e[0]){case"header":e[0]="h"+e[1].level,delete e[1].level;break;case"bulletlist":e[0]="ul";break;case"numberlist":e[0]="ol";break;case"listitem":e[0]="li";break;case"para":e[0]="p";break;case"markdown":e[0]="html",f&&delete f.references;break;case"code_block":e[0]="pre",c=f?2:1;var s=["code"];s.push.apply(s,e.splice(c)),e[c]=s;break;case"inlinecode":e[0]="code";break;case"img":e[1].src=e[1].href,delete e[1].href;break;case"linebreak":e[0]="br";break;case"link":e[0]="a";break;case"link_ref":e[0]="a",c=b[f.ref];if(!c)return f.original;delete f.ref,f.href=c.href,c.title&&(f.title=c.title),delete f.original;break;case"img_ref":e[0]="img",c=b[f.ref];if(!c)return f.original;delete f.ref,f.src=c.href,c.title&&(f.title=c.title),delete f.original}c=1;if(f){for(var k in e[1])c=2;1===c&&e.splice(c,1)}for(;c<e.length;++c)e[c]=arguments.callee(e[c],b,d);return e}function M(g){for(var b=q(g)?2:1;b<g.length;)"string"==typeof g[b]?b+1<g.length&&"string"==typeof g[b+1]?g[b]+=g.splice(b+1,1)[0]:++b:(arguments.callee(g[b]),++b)}var g=t.Markdown=function b(d){switch(typeof d){case"undefined":this.dialect=b.dialects.Gruber;break;case"object":this.dialect=d;break;default:if(!(d in b.dialects))throw Error("Unknown Markdown dialect '"+String(d)+"'");this.dialect=b.dialects[d]}this.em_state=[],this.strong_state=[],this.debug_indent=""};t.parse=function(b,d){return(new g(d)).toTree(b)},t.toHTML=function(b,d,c){return b=t.toHTMLTree(b,d,c),t.renderJsonML(b)},t.toHTMLTree=function(b,d,c){"string"==typeof b&&(b=this.parse(b,d)),d=q(b);var e={};return d&&d.references&&(e=d.references),b=L(b,e,c),M(b),b};var l=g.mk_block=function(b,d,c){1==arguments.length&&(d="\n\n");var e=new String(b);return e.trailing=d,e.inspect=K,e.toSource=J,void 0!=c&&(e.lineNumber=c),e};g.prototype.split_blocks=function(b,d){var c=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,e=[],f,g=1;for(null!=(f=/^(\s*\n)/.exec(b))&&(g+=A(f[0]),c.lastIndex=f[0].length);null!==(f=c.exec(b));)e.push(l(f[1],f[2],g)),g+=A(f[0]);return e},g.prototype.processBlock=function(b,d){var c=this.dialect.block,e=c.__order__;if("__call__"in c)return c.__call__.call(this,b,d);for(var f=0;f<e.length;f++){var g=c[e[f]].call(this,b,d);if(g)return(!w(g)||0<g.length&&!w(g[0]))&&this.debug(e[f],"didn't return a proper array"),g}return[]},g.prototype.processInline=function(b){return this.dialect.inline.__call__.call(this,String(b))},g.prototype.toTree=function(b,d){var c=b instanceof Array?b:this.split_blocks(b),e=this.tree;try{this.tree=d||this.tree||["markdown"];a:for(;c.length;){var f=this.processBlock(c.shift(),c);if(!f.length)continue a;this.tree.push.apply(this.tree,f)}return this.tree}finally{d&&(this.tree=e)}},g.prototype.debug=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,b),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,b)},g.prototype.loop_re_over_block=function(b,d,c){var e;for(d=d.valueOf();d.length&&null!=(e=b.exec(d));)d=d.substr(e[0].length),c.call(this,e);return d},g.dialects={},g.dialects.Gruber={block:{atxHeader:function(b,d){var c=b.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var e=["header",{level:c[1].length}];return Array.prototype.push.apply(e,this.processInline(c[2])),c[0].length<b.length&&d.unshift(l(b.substr(c[0].length),b.trailing,b.lineNumber+2)),[e]}},setextHeader:function(b,d){var c=b.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var e=["header",{level:"="===c[2]?1:2},c[1]];return c[0].length<b.length&&d.unshift(l(b.substr(c[0].length),b.trailing,b.lineNumber+2)),[e]}},code:function(b,d){var c=[],e=/^(?: {0,3}\t| {4})(.*)\n?/;if(b.match(e)){a:do{var f=this.loop_re_over_block(e,b.valueOf(),function(b){c.push(b[1])});if(f.length){d.unshift(l(f,b.trailing));break a}if(!d.length)break a;if(!d[0].match(e))break a;c.push(b.trailing.replace(/[^\n]/g,"").substring(2)),b=d.shift()}while(1);return[["code_block",c.join("\n")]]}},horizRule:function(b,d){var c=b.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var e=[["hr"]];return c[1]&&e.unshift.apply(e,this.processBlock(c[1],[])),c[3]&&d.unshift(l(c[3])),e}},lists:function(){function b(b){return new RegExp("(?:^("+h+"{0,"+b+"} {0,3})("+f+")\\s+)|(^"+h+"{0,"+(b-1)+"}[ ]{0,4})")}function d(b,c,d,e){if(c)b.push(["para"].concat(d));else for(c=b[b.length-1]instanceof Array&&"para"==b[b.length-1][0]?b[b.length-1]:b,e&&1<b.length&&d.unshift(e),b=0;b<d.length;b++)e=d[b],"string"==typeof e&&1<c.length&&"string"==typeof c[c.length-1]?c[c.length-1]+=e:c.push(e)}function c(b,c){for(var d=new RegExp("^("+h+"{"+b+"}.*?\\n?)*$"),e=new RegExp("^"+h+"{"+b+"}","gm"),f=[];0<c.length;){d.exec(c[0])&&(d=c.shift(),e=d.replace(e,""),f.push(l(e,d.trailing,d.lineNumber)));break}return f}function e(b,c,d){b=b.list,b=b[b.length-1],b[1]instanceof Array&&"para"==b[1][0]||(c+1==d.length?b.push(["para"].concat(b.splice(1))):(c=b.pop(),b.push(["para"].concat(b.splice(1)),c)))}var f="[*+-]|\\d+\\.",g=/[*+-]/,k=new RegExp("^( {0,3})("+f+")[ 	]+"),h="(?: {0,3}\\t| {4})";return function(f,h){function q(b){var c=g.exec(b[2])?["bulletlist"]:["numberlist"];return n.push({list:c,indent:b[1]}),c}var m=f.match(k);if(m){var n=[],x=q(m),v,r=!1,t=[n[0].list],l;a:for(;;){for(var z=f.split(/(?=\n)/),y="",w=0;w<z.length;w++){var B="",F=z[w].replace(/^\n/,function(b){return B=b,""}),m=b(n.length),m=F.match(m);if(void 0!==m[1]){y.length&&(d(v,r,this.processInline(y),B),r=!1,y=""),m[1]=m[1].replace(/ {0,3}\t/g,"    ");var C=Math.floor(m[1].length/4)+1;if(C>n.length)x=q(m),v.push(x),v=x[1]=["listitem"];else{var A=!1;for(l=0;l<n.length;l++)if(n[l].indent==m[1]){x=n[l].list,n.splice(l+1),A=!0;break}A||(C++,C<=n.length?(n.splice(C),x=n[C-1].list):(x=q(m),v.push(x))),v=["listitem"],x.push(v)}B=""}F.length>m[0].length&&(y+=B+F.substr(m[0].length))}y.length&&(d(v,r,this.processInline(y),B),r=!1,y=""),r=c(n.length,h),0<r.length&&(D(n,e,this),v.push.apply(v,this.toTree(r,[]))),r=h[0]&&h[0].valueOf()||"";if(r.match(k)||r.match(/^ /)){f=h.shift();if(r=this.dialect.block.horizRule(f,h)){t.push.apply(t,r);break}D(n,e,this),r=!0;continue a}break}return t}}}(),blockquote:function(b,d){if(b.match(/^>/m)){var c=[];if(">"!=b[0]){for(var e=b.split(/\n/),f=[];e.length&&">"!=e[0][0];)f.push(e.shift());b=e.join("\n"),c.push.apply(c,this.processBlock(f.join("\n"),[]))}for(;d.length&&">"==d[0][0];)e=d.shift(),b=new String(b+b.trailing+e),b.trailing=e.trailing;return e=b.replace(/^> ?/gm,""),c.push(this.toTree(e,["blockquote"])),c}},referenceDefn:function(b,d){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(b.match(c)){q(this.tree)||this.tree.splice(1,0,{});var e=q(this.tree);return void 0===e.references&&(e.references={}),c=this.loop_re_over_block(c,b,function(b){b[2]&&"<"==b[2][0]&&">"==b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1));var c=e.references[b[1].toLowerCase()]={href:b[2]};void 0!==b[4]?c.title=b[4]:void 0!==b[5]&&(c.title=b[5])}),c.length&&d.unshift(l(c,b.trailing)),[]}},para:function(b,d){return[["para"].concat(this.processInline(b))]}}},g.dialects.Gruber.inline={__oneElement__:function(b,d,c){var e;return d=d||this.dialect.inline.__patterns__,(d=(new RegExp("([\\s\\S]*?)("+(d.source||d)+")")).exec(b))?d[1]?[d[1].length,d[1]]:(d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,b.substr(d.index),d,c||[])),e=e||[d[2].length,d[2]],e):[b.length,b]},__call__:function(b,d){function c(b){"string"==typeof b&&"string"==typeof e[e.length-1]?e[e.length-1]+=b:e.push(b)}for(var e=[],f;0<b.length;)f=this.dialect.inline.__oneElement__.call(this,b,d,e),b=b.substr(f.shift()),D(f,c);return e},"]":function(){},"}":function(){},"\\":function(b){return b.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)?[2,b[1]]:[1,"\\"]},"![":function(b){var d=b.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);return d?(d[2]&&"<"==d[2][0]&&">"==d[2][d[2].length-1]&&(d[2]=d[2].substring(1,d[2].length-1)),d[2]=this.dialect.inline.__call__.call(this,d[2],/\\/)[0],b={alt:d[1],href:d[2]||""},void 0!==d[4]&&(b.title=d[4]),[d[0].length,["img",b]]):(d=b.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),d?[d[0].length,["img_ref",{alt:d[1],ref:d[2].toLowerCase(),original:d[0]}]]:[2,"!["])},"[":function(b){var d=String(b),c=g.DialectHelpers.inline_until_char.call(this,b.substr(1),"]");if(!c)return[1,"["];var e=1+c[0],c=c[1],f,s;b=b.substr(e);var k=b.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(k){b=k[1],e+=k[0].length,b&&"<"==b[0]&&">"==b[b.length-1]&&(b=b.substring(1,b.length-1));if(!k[3])for(var d=1,h=0;h<b.length;h++)switch(b[h]){case"(":d++;break;case")":0==--d&&(e-=b.length-h,b=b.substring(0,h))}return b=this.dialect.inline.__call__.call(this,b,/\\/)[0],s={href:b||""},void 0!==k[3]&&(s.title=k[3]),f=["link",s].concat(c),[e,f]}return k=b.match(/^\s*\[(.*?)\]/),k?(e+=k[0].length,s={ref:(k[1]||String(c)).toLowerCase(),original:d.substr(0,e)},f=["link_ref",s].concat(c),[e,f]):1==c.length&&"string"==typeof c[0]?(s={ref:c[0].toLowerCase(),original:d.substr(0,e)},f=["link_ref",s,c[0]],[e,f]):[1,"["]},"<":function(b){var d;return null!=(d=b.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?d[3]?[d[0].length,["link",{href:"mailto:"+d[3]},d[3]]]:"mailto"==d[2]?[d[0].length,["link",{href:d[1]},d[1].substr(7)]]:[d[0].length,["link",{href:d[1]},d[1]]]:[1,"<"]},"`":function(b){return(b=b.match(/(`+)(([\s\S]*?)\1)/))&&b[2]?[b[1].length+b[2].length,["inlinecode",b[3]]]:[1,"`"]},"  \n":function(b){return[3,["linebreak"]]}},g.dialects.Gruber.inline["**"]=z("strong","**"),g.dialects.Gruber.inline.__=z("strong","__"),g.dialects.Gruber.inline["*"]=z("em","*"),g.dialects.Gruber.inline._=z("em","_"),g.buildBlockOrder=function(b){var d=[],c;for(c in b)"__order__"!=c&&"__call__"!=c&&d.push(c);b.__order__=d},g.buildInlinePatterns=function(b){var d=[],c;for(c in b)if(!c.match(/^__.*__$/)){var e=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");d.push(1==c.length?e:"(?:"+e+")")}d=d.join("|"),b.__patterns__=d;var f=b.__call__;b.__call__=function(b,c){return void 0!=c?f.call(this,b,c):f.call(this,b,d)}},g.DialectHelpers={},g.DialectHelpers.inline_until_char=function(b,d){for(var c=0,e=[];;){if(b[c]==d)return c++,[c,e];if(c>=b.length)return null;res=this.dialect.inline.__oneElement__.call(this,b.substr(c)),c+=res[0],e.push.apply(e,res.slice(1))}},g.subclassDialect=function(b){function d(){}function c(){}return d.prototype=b.block,c.prototype=b.inline,{block:new d,inline:new c}},g.buildBlockOrder(g.dialects.Gruber.block),g.buildInlinePatterns(g.dialects.Gruber.inline),g.dialects.Maruku=g.subclassDialect(g.dialects.Gruber),g.dialects.Maruku.processMetaHash=function(b){var d=b.split("");b=[""];for(var c=!1;d.length;){var e=d.shift();switch(e){case" ":c?b[b.length-1]+=e:b.push("");break;case"'":case'"':c=!c;break;case"\\":e=d.shift();default:b[b.length-1]+=e}}d={};for(c=0;c<b.length;++c)/^#/.test(b[c])?d.id=b[c].substring(1):/^\./.test(b[c])?d["class"]?d["class"]+=b[c].replace(/./," "):d["class"]=b[c].substring(1):/\=/.test(b[c])&&(e=b[c].split(/\=/),d[e[0]]=e[1]);return d},g.dialects.Maruku.block.document_meta=function(b,d){if(!(1<b.lineNumber)&&b.match(/^(?:\w+:.*\n)*\w+:.*$/)){q(this.tree)||this.tree.splice(1,0,{});var c=b.split(/\n/);for(p in c){var e=c[p].match(/(\w+):\s*(.*)$/),f=e[1].toLowerCase();this.tree[1][f]=e[2]}return[]}},g.dialects.Maruku.block.block_meta=function(b,d){var c=b.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(c){var e=this.dialect.processMetaHash(c[2]);if(""===c[1]){var f=this.tree[this.tree.length-1],c=q(f);if("string"==typeof f)return;c||(c={},f.splice(1,0,c));for(a in e)c[a]=e[a];return[]}c=b.replace(/\n.*$/,""),f=this.processBlock(c,[]),(c=q(f[0]))||(c={},f[0].splice(1,0,c));for(a in e)c[a]=e[a];return f}},g.dialects.Maruku.block.definition_list=function(b,d){var c=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,e=["dl"],f;if(b.match(c)){for(var g=[b];d.length&&c.exec(d[0]);)g.push(d.shift());for(var k=0;k<g.length;++k){f=g[k].match(c);var h=f[1].replace(/\n$/,"").split(/\n/),l=f[2].split(/\n:\s+/);for(f=0;f<h.length;++f)e.push(["dt",h[f]]);for(f=0;f<l.length;++f)e.push(["dd"].concat(this.processInline(l[f].replace(/(\n)\s+/,"$1"))))}return[e]}},g.dialects.Maruku.inline["{:"]=function(b,d,c){if(!c.length)return[2,"{:"];d=c[c.length-1];if("string"==typeof d)return[2,"{:"];b=b.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!b)return[2,"{:"];c=this.dialect.processMetaHash(b[1]);var e=q(d);e||(e={},d.splice(1,0,e));for(var f in c)e[f]=c[f];return[b[0].length,""]},g.buildBlockOrder(g.dialects.Maruku.block),g.buildInlinePatterns(g.dialects.Maruku.inline);var w=Array.isArray||function(b){return"[object Array]"==Object.prototype.toString.call(b)},D;Array.prototype.forEach?D=function(b,d,c){return b.forEach(d,c)}:D=function(b,d,c){for(var e=0;e<b.length;e++)d.call(c||b,b[e],e,b)},t.renderJsonML=function(b,d){d=d||{},d.root=d.root||!1;var c=[];if(d.root)c.push(I(b));else for(b.shift(),!b.length||"object"!=typeof b[0]||b[0]instanceof Array||b.shift();b.length;)c.push(I(b.shift()));return c.join("\n\n")}})(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}());
	  
	  
	  
	
veneer("veneer-markdown", {

	events: {

		update: function upd(e){ 
			var elm=e.target;
			if(!elm._temp){ elm._temp=elm.textContent;  }
			elm.innerHTML=markdown.toHTML(elm._temp);
			elm.className="busy";
			setTimeout(function(){elm.className="";}, 333 );
			elm.setAttribute("data-done", true );
		}
	},
	css:  "veneer-markdown {display: block; white-space: pre; } veneer-markdown[data-done] { white-space: normal; } " 
  });
  
}());